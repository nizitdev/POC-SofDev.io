{"version":3,"file":"webpack.config.js","sourceRoot":"","sources":["webpack.config.ts"],"names":[],"mappings":"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","sourcesContent":["const path = require(\"path\");\r\nconst autoprefixer = require(\"autoprefixer\");\r\nconst htmlWebpackPlugin = require(\"html-webpack-plugin\");\r\nconst cleanWebpackPlugin = require(\"clean-webpack-plugin\");\r\nconst UglifyJsPlugin = require(\"uglifyjs-webpack-plugin\");\r\nconst MiniCssExtractPlugin = require(\"mini-css-extract-plugin\");\r\nconst OptimizeCSSAssetsPlugin = require(\"optimize-css-assets-webpack-plugin\");\r\nconst CompressionPlugin = require(\"compression-webpack-plugin\");\r\nimport { ConfigurationManager } from \"@nivinjoseph/n-config\";\r\n\r\nconst env = ConfigurationManager.getConfig<string>(\"env\");\r\nconsole.log(\"WEBPACK ENV\", env);\r\n\r\nconst isDev = env === \"dev\";\r\n\r\nconst moduleRules: Array<any> = [\r\n    {\r\n        test: /\\.(scss|sass)$/,\r\n        use: [{\r\n            loader: isDev ? \"style-loader\" : MiniCssExtractPlugin.loader\r\n        }, {\r\n            loader: \"css-loader\" // translates CSS into CommonJS\r\n        }, {\r\n            loader: \"postcss-loader\", // postcss\r\n            options: {\r\n                plugins: () => [\r\n                    require(\"postcss-flexbugs-fixes\"),\r\n                    autoprefixer({\r\n                        browsers: [\r\n                            \">1%\",\r\n                            \"not ie < 9\"\r\n                        ],\r\n                        flexbox: \"no-2009\"\r\n                    })\r\n                ]\r\n            }\r\n        }, {\r\n            loader: \"sass-loader\" // compiles Sass to CSS -> depends on node-sass\r\n        }]\r\n    },\r\n    {\r\n        test: /\\.css$/,\r\n        use: [{\r\n            loader: isDev ? \"style-loader\" : MiniCssExtractPlugin.loader\r\n        }, {\r\n            loader: \"css-loader\" // translates CSS into CommonJS\r\n        }]\r\n    },\r\n    {\r\n        test: /\\.svg$/,\r\n        use: [\r\n            isDev ? \"file-loader\" : {\r\n                loader: \"url-loader\",\r\n                options: {\r\n                    limit: 9000,\r\n                    fallback: \"file-loader\"\r\n                }\r\n            }\r\n        ]\r\n    },\r\n    {\r\n        test: /\\.(png|jpg|jpeg|gif)$/,\r\n        use: [\r\n            isDev ? \"file-loader\" : {\r\n                loader: \"url-loader\",\r\n                options: {\r\n                    limit: 9000,\r\n                    fallback: \"file-loader\"\r\n                }\r\n            },\r\n            {\r\n                loader: \"image-webpack-loader\",\r\n                options: {\r\n                    bypassOnDebug: true,\r\n                }\r\n            }\r\n        ]\r\n    },\r\n    {\r\n        test: /\\.(woff|woff2|eot|ttf|otf)$/,\r\n        use: [\r\n            isDev ? \"file-loader\" : {\r\n                loader: \"url-loader\",\r\n                options: {\r\n                    limit: 9000,\r\n                    fallback: \"file-loader\"\r\n                }\r\n            }\r\n        ]\r\n    },\r\n    {\r\n        test: /\\.(html)$/,\r\n        use: {\r\n            loader: \"html-loader\",\r\n            options: {\r\n                attrs: [\"img:src\", \"use:xlink:href\"]\r\n            }\r\n        }\r\n    }\r\n];\r\n\r\nconst plugins = [\r\n    new cleanWebpackPlugin([\"src/client/dist\"]),\r\n    new htmlWebpackPlugin({\r\n        template: \"src/server/controllers/index/index-view.html\",\r\n        filename: \"index-view.html\",\r\n        hash: true\r\n    })\r\n];\r\n\r\nif (!isDev)\r\n{\r\n    moduleRules.push({\r\n        test: /\\.js$/,\r\n        use: {\r\n            loader: \"babel-loader\",\r\n            options: {\r\n                presets: [[\"@babel/preset-env\", {\r\n                    debug: false,\r\n                    targets: {\r\n                        // browsers: [\"> 1%\", \"Chrome >= 41\"],\r\n                        chrome: \"41\" // this is what googles web crawler uses\r\n                    },\r\n                    useBuiltIns: \"entry\",\r\n                    forceAllTransforms: true,\r\n                    modules: \"commonjs\"\r\n                }]]\r\n            }\r\n        }\r\n    });\r\n    \r\n    plugins.push(...[\r\n        new MiniCssExtractPlugin({\r\n            filename: \"client.bundle.css\"\r\n        }),\r\n        new CompressionPlugin({\r\n            test: /\\.(js|css|svg)$/\r\n        })\r\n    ]);\r\n}\r\n\r\nmodule.exports = {\r\n    mode: isDev ? \"development\" : \"production\",\r\n    target: \"web\",\r\n    entry: [\"./src/client/client.js\"],\r\n    output: {\r\n        filename: \"client.bundle.js\",\r\n        path: path.resolve(__dirname, \"src/client/dist\"),\r\n        publicPath: \"/\"\r\n    },\r\n    devtool: isDev ? \"inline-source-map\" : \"source-map\",\r\n    optimization: {\r\n        minimizer: [\r\n            new UglifyJsPlugin({\r\n                sourceMap: true,\r\n                uglifyOptions: {\r\n                    keep_classnames: true,\r\n                    keep_fnames: true,\r\n                    safari10: true\r\n                }\r\n            }),\r\n            new OptimizeCSSAssetsPlugin({})\r\n        ]\r\n    },\r\n    module: {\r\n        rules: moduleRules\r\n    },\r\n    plugins: plugins\r\n};"]}