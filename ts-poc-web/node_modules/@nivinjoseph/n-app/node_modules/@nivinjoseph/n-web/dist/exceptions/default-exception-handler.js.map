{"version":3,"file":"default-exception-handler.js","sourceRoot":"","sources":["../../src/exceptions/default-exception-handler.ts"],"names":[],"mappings":";;;;;;;;;;AAAA,0DAA2E;AAC3E,0DAAiD;AACjD,8BAA4B;AAC5B,2DAAuD;AACvD,qDAAiD;AAIjD,MAAa,uBAAwB,SAAQ,oCAAgB;IAOzD,YAAmB,MAAc,EAAE,aAAa,GAAG,IAAI;QAEnD,KAAK,EAAE,CAAC;QACR,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;QACtB,IAAI,CAAC,cAAc,GAAG,CAAC,CAAC,aAAa,CAAC;QACtC,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;IACxB,CAAC;IAGY,MAAM,CAAC,GAAc;;YAE9B,IAAI,IAAI,CAAC,cAAc;gBACnB,MAAM,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YAExB,MAAM,IAAI,GAAY,GAAI,CAAC,WAAW,EAAE,CAAC;YACzC,MAAM,OAAO,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;YACrC,IAAI,OAAO;gBACP,OAAO,MAAM,OAAO,CAAC,GAAG,CAAC,CAAC;;gBAE1B,MAAM,IAAI,8BAAa,CAAC,GAAG,EAAE,6CAA6C,CAAC,CAAC;QACpF,CAAC;KAAA;IAGS,eAAe,CAAC,aAAuB,EAAE,OAAuC;QAEtF,mBAAK,CAAC,aAAa,EAAE,eAAe,CAAC,CAAC,cAAc,EAAE,CAAC,gBAAgB,EAAE,CAAC;QAC1E,mBAAK,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC,cAAc,EAAE,CAAC,gBAAgB,EAAE,CAAC;QAE9D,MAAM,IAAI,GAAY,aAAc,CAAC,WAAW,EAAE,CAAC;QACnD,IAAI,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC;YACpB,MAAM,IAAI,kCAAoB,CAAC,sDAAsD,IAAI,IAAI,CAAC,CAAC;QAEnG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,OAAO,CAAC;IACnC,CAAC;IAES,GAAG,CAAC,GAA4B;QAEtC,IACA;YACI,IAAI,UAAU,GAAG,EAAE,CAAC;YACpB,IAAI,GAAG,YAAY,uBAAS;gBACxB,UAAU,GAAG,GAAG,CAAC,QAAQ,EAAE,CAAC;iBAC3B,IAAI,GAAG,YAAY,KAAK;gBACzB,UAAU,GAAG,GAAG,CAAC,KAAK,CAAC;;gBAEvB,UAAU,GAAG,GAAG,CAAC,QAAQ,EAAE,CAAC;YAEhC,OAAO,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;SAC5C;QACD,OAAO,KAAK,EACZ;YACI,OAAO,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,2DAA2D,CAAC,CAAC;SAC7F;IACL,CAAC;CACJ;AA7DD,0DA6DC","sourcesContent":["import { Exception, ApplicationException } from \"@nivinjoseph/n-exception\";\nimport { given } from \"@nivinjoseph/n-defensive\";\nimport \"@nivinjoseph/n-ext\";\nimport { ExceptionHandler } from \"./exception-handler\";\nimport { HttpException } from \"./http-exception\";\nimport { Logger } from \"@nivinjoseph/n-log\";\n\n// public\nexport class DefaultExceptionHandler extends ExceptionHandler\n{\n    private readonly _logger: Logger;\n    private readonly _logEverything: boolean;\n    private readonly _handlers: { [index: string]: (exp: Exception) => Promise<any> };\n\n\n    public constructor(logger: Logger, logEverything = true)\n    {\n        super();\n        this._logger = logger;\n        this._logEverything = !!logEverything;\n        this._handlers = {};\n    }\n\n\n    public async handle(exp: Exception): Promise<any>\n    {\n        if (this._logEverything)\n            await this.log(exp);\n\n        const name = (<Object>exp).getTypeName();\n        const handler = this._handlers[name];\n        if (handler)\n            return await handler(exp);\n        else\n            throw new HttpException(500, \"There was an error processing your request.\");\n    }\n\n\n    protected registerHandler(exceptionType: Function, handler: (e: Exception) => Promise<any>): void\n    {\n        given(exceptionType, \"exceptionType\").ensureHasValue().ensureIsFunction();\n        given(handler, \"handler\").ensureHasValue().ensureIsFunction();\n\n        const name = (<Object>exceptionType).getTypeName();\n        if (this._handlers[name])\n            throw new ApplicationException(`Duplicate handler registration for Exception type '${name}'.`);\n\n        this._handlers[name] = handler;\n    }\n\n    protected log(exp: Exception | Error | any): Promise<void>\n    {\n        try \n        {\n            let logMessage = \"\";\n            if (exp instanceof Exception)\n                logMessage = exp.toString();\n            else if (exp instanceof Error)\n                logMessage = exp.stack;\n            else\n                logMessage = exp.toString();\n\n            return this._logger.logError(logMessage);\n        }\n        catch (error)\n        {\n            return this._logger.logError(\"There was an error while attempting to log another error.\");\n        }\n    }\n}"]}