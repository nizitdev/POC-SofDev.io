{"version":3,"file":"default-event-bus.js","sourceRoot":"","sources":["../../../src/services/event-bus/default-event-bus.ts"],"names":[],"mappings":";;;;;;;;;;AAEA,0DAAiD;AACjD,gDAA0D;AAG1D,MAAa,eAAe;IAA5B;QAEqB,mBAAc,GAAkD,EAAE,CAAC;IAqCxF,CAAC;IAjCU,YAAY,CAAC,SAA8B;QAE9C,mBAAK,CAAC,SAAS,EAAE,WAAW,CAAC,CAAC,cAAc,EAAE,CAAC,YAAY,CAAC,4BAAmB,CAAC,CAAC;QACjF,IAAI,CAAC,UAAU,GAAG,SAAS,CAAC;IAChC,CAAC;IAGY,OAAO,CAAC,KAAa;;YAE9B,mBAAK,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC,cAAc,EAAE,CAAC,cAAc,EAAE,CAAC;YAExD,MAAM,SAAS,GAAY,KAAM,CAAC,WAAW,EAAE,CAAC;YAEhD,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,SAAS,CAAC;gBAC/B,OAAO;YAEX,MAAM,aAAa,GAAG,IAAI,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC;YACrD,aAAa,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;QACrF,CAAC;KAAA;IAEM,SAAS,CAAC,aAAqB,EAAE,OAA0B;QAE9D,mBAAK,CAAC,aAAa,EAAE,eAAe,CAAC,CAAC,cAAc,EAAE,CAAC,cAAc,EAAE,CAAC;QACxE,mBAAK,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC,cAAc,EAAE,CAAC,cAAc,EAAE,CAAC;QAE5D,aAAa,GAAG,aAAa,CAAC,IAAI,EAAE,CAAC;QAErC,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC;YACnC,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,GAAG,IAAI,KAAK,EAAqB,CAAC;QAExE,MAAM,aAAa,GAAG,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,CAAC;QACzD,aAAa,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;IAChC,CAAC;CACJ;AAvCD,0CAuCC","sourcesContent":["import { EventBus } from \"./event-bus\";\nimport { EventHandler } from \"./event-handler\";\nimport { given } from \"@nivinjoseph/n-defensive\";\nimport { BackgroundProcessor } from \"@nivinjoseph/n-util\";\n\n\nexport class DefaultEventBus implements EventBus\n{\n    private readonly _subscriptions: { [index: string]: Array<EventHandler<any>> } = {};\n    private _processor: BackgroundProcessor;\n    \n    \n    public useProcessor(processor: BackgroundProcessor): void\n    {\n        given(processor, \"processor\").ensureHasValue().ensureIsType(BackgroundProcessor);\n        this._processor = processor;\n    }\n    \n    \n    public async publish(event: object): Promise<void>\n    {\n        given(event, \"event\").ensureHasValue().ensureIsObject();\n\n        const eventName = (<Object>event).getTypeName();\n\n        if (!this._subscriptions[eventName])\n            return;\n        \n        const eventHandlers = this._subscriptions[eventName];\n        eventHandlers.forEach(t => this._processor.processAction(() => t.handle(event)));\n    }\n    \n    public subscribe(eventTypeName: string, handler: EventHandler<any>): void\n    {\n        given(eventTypeName, \"eventTypeName\").ensureHasValue().ensureIsString();\n        given(handler, \"handler\").ensureHasValue().ensureIsObject();\n\n        eventTypeName = eventTypeName.trim();\n\n        if (!this._subscriptions[eventTypeName])\n            this._subscriptions[eventTypeName] = new Array<EventHandler<any>>();\n\n        const eventHandlers = this._subscriptions[eventTypeName];\n        eventHandlers.push(handler);\n    }\n}"]}