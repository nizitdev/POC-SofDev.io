{"version":3,"file":"mark-todo-as-completed.js","sourceRoot":"","sources":["mark-todo-as-completed.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAAA,8CAAgE;AAChE,oCAAoC;AACpC,gDAA6C;AAE7C,0DAAiD;AACjD,wDAAoD;AACpD,gFAA4E;AAM5E,IAAa,6BAA6B,GAA1C,MAAa,6BAA8B,SAAQ,kBAAU;IAKzD,YAAmB,cAA8B;QAE7C,KAAK,EAAE,CAAC;QAER,mBAAK,CAAC,cAAc,EAAE,gBAAgB,CAAC,CAAC,cAAc,EAAE,CAAC,cAAc,EAAE,CAAC;QAC1E,IAAI,CAAC,eAAe,GAAG,cAAc,CAAC;IAC1C,CAAC;IAGY,OAAO,CAAC,KAAY;;YAE7B,mBAAK,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC,cAAc,EAAE,CAAC,cAAc,EAAE,CAAC;YAExD,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;YAE1B,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;YACtD,IAAI,CAAC,eAAe,EAAE,CAAC;YACvB,MAAM,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC1C,CAAC;KAAA;IAGO,aAAa,CAAC,KAAY;QAE9B,IAAI,SAAS,GAAG,IAAI,sBAAS,EAAS,CAAC;QAEvC,SAAS,CAAC,GAAG,CAAS,IAAI,CAAC;aACtB,UAAU,EAAE;aACZ,cAAc,EAAE,CAAC;QAEtB,SAAS,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;QAE1B,IAAI,SAAS,CAAC,SAAS;YACnB,MAAM,IAAI,0CAAmB,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;IACxD,CAAC;CACJ,CAAA;AAvCY,6BAA6B;IAHzC,aAAK,CAAC,MAAM,CAAC,OAAO,CAAC,mBAAmB,CAAC;IACzC,eAAO;IACP,eAAM,CAAC,gBAAgB,CAAC;;GACZ,6BAA6B,CAuCzC;AAvCY,sEAA6B","sourcesContent":["import { Controller, command, route } from \"@nivinjoseph/n-web\";\r\nimport * as Routes from \"../routes\";\r\nimport { inject } from \"@nivinjoseph/n-ject\";\r\nimport { TodoRepository } from \"../../../domain/repositories/todo-repository\";\r\nimport { given } from \"@nivinjoseph/n-defensive\";\r\nimport { Validator } from \"@nivinjoseph/n-validate\";\r\nimport { ValidationException } from \"../../exceptions/validation-exception\";\r\n\r\n\r\n@route(Routes.command.markTodoAsCompleted)\r\n@command\r\n@inject(\"TodoRepository\")\r\nexport class MarkTodoAsCompletedController extends Controller\r\n{\r\n    private readonly _todoRepository: TodoRepository;\r\n\r\n\r\n    public constructor(todoRepository: TodoRepository)\r\n    {\r\n        super();\r\n        \r\n        given(todoRepository, \"todoRepository\").ensureHasValue().ensureIsObject();\r\n        this._todoRepository = todoRepository;\r\n    }\r\n\r\n    \r\n    public async execute(model: Model): Promise<void>\r\n    {\r\n        given(model, \"model\").ensureHasValue().ensureIsObject();\r\n\r\n        this.validateModel(model);\r\n\r\n        const todo = await this._todoRepository.get(model.id);\r\n        todo.markAsCompleted();\r\n        await this._todoRepository.save(todo);\r\n    }\r\n    \r\n    \r\n    private validateModel(model: Model): void\r\n    {\r\n        let validator = new Validator<Model>();\r\n\r\n        validator.for<string>(\"id\")\r\n            .isRequired()\r\n            .ensureIsString();\r\n\r\n        validator.validate(model);\r\n\r\n        if (validator.hasErrors)\r\n            throw new ValidationException(validator.errors);\r\n    }\r\n}\r\n\r\n\r\ninterface Model\r\n{\r\n    id: string;\r\n}"]}