{"version":3,"file":"update-todo-command.js","sourceRoot":"","sources":["update-todo-command.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAAA,8CAAgE;AAChE,oCAAoC;AACpC,gDAA6C;AAE7C,0DAAiD;AACjD,wDAA4D;AAC5D,gFAA4E;AAM5E,IAAa,oBAAoB,GAAjC,MAAa,oBAAqB,SAAQ,kBAAU;IAKhD,YAAmB,cAA8B;QAE7C,KAAK,EAAE,CAAC;QAER,mBAAK,CAAC,cAAc,EAAE,gBAAgB,CAAC,CAAC,cAAc,EAAE,CAAC,cAAc,EAAE,CAAC;QAC1E,IAAI,CAAC,eAAe,GAAG,cAAc,CAAC;IAC1C,CAAC;IAGY,OAAO,CAAC,KAAY;;YAE7B,mBAAK,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC,cAAc,EAAE,CAAC,cAAc,EAAE,CAAC;YAExD,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;YAE1B,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC;YACtD,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;YAC9B,IAAI,CAAC,iBAAiB,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC;YAE1C,OAAO,CAAC,GAAG,CAAC,cAAc,EAAE,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC;YACrD,OAAO,CAAC,GAAG,CAAC,gBAAgB,EAAE,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;YACzD,MAAM,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC1C,CAAC;KAAA;IAGO,aAAa,CAAC,KAAY;QAE9B,IAAI,SAAS,GAAG,IAAI,sBAAS,EAAS,CAAC;QAEvC,SAAS,CAAC,GAAG,CAAS,IAAI,CAAC;aACtB,UAAU,EAAE;aACZ,cAAc,EAAE,CAAC;QAEtB,SAAS,CAAC,GAAG,CAAS,OAAO,CAAC;aACzB,UAAU,EAAE;aACZ,cAAc,EAAE;aAChB,iBAAiB,CAAC,mBAAM,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC,CAAC;QAEjD,SAAS,CAAC,GAAG,CAAS,aAAa,CAAC;aAC/B,UAAU,EAAE;aACZ,cAAc,EAAE;aAChB,iBAAiB,CAAC,mBAAM,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC,CAAC;QAEjD,SAAS,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;QAE1B,IAAI,SAAS,CAAC,SAAS;YACnB,MAAM,IAAI,0CAAmB,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;IACxD,CAAC;CACJ,CAAA;AArDY,oBAAoB;IAHhC,aAAK,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC;IAChC,eAAO;IACP,eAAM,CAAC,gBAAgB,CAAC;;GACZ,oBAAoB,CAqDhC;AArDY,oDAAoB","sourcesContent":["import { Controller, command, route } from \"@nivinjoseph/n-web\";\nimport * as Routes from \"../routes\";\nimport { inject } from \"@nivinjoseph/n-ject\";\nimport { TodoRepository } from \"../../../domain/repositories/todo-repository\";\nimport { given } from \"@nivinjoseph/n-defensive\";\nimport { Validator, strval } from \"@nivinjoseph/n-validate\";\nimport { ValidationException } from \"../../exceptions/validation-exception\";\n\n\n@route(Routes.command.updateTodo)\n@command\n@inject(\"TodoRepository\")\nexport class UpdateTodoController extends Controller\n{\n    private readonly _todoRepository: TodoRepository;\n\n\n    public constructor(todoRepository: TodoRepository)\n    {\n        super();\n        \n        given(todoRepository, \"todoRepository\").ensureHasValue().ensureIsObject();\n        this._todoRepository = todoRepository;\n    }\n\n\n    public async execute(model: Model): Promise<void>\n    {\n        given(model, \"model\").ensureHasValue().ensureIsObject();\n\n        this.validateModel(model);\n\n        const todo = await this._todoRepository.get(model.id);\n        todo.updateTitle(model.title);\n        todo.updateDescription(model.description);\n\n        console.log(\"retro events\", todo.retroEvents.length);\n        console.log(\"current events\", todo.currentEvents.length);\n        await this._todoRepository.save(todo);\n    }\n\n\n    private validateModel(model: Model): void\n    {\n        let validator = new Validator<Model>();\n\n        validator.for<string>(\"id\")\n            .isRequired()\n            .ensureIsString();\n        \n        validator.for<string>(\"title\")\n            .isRequired()\n            .ensureIsString()\n            .useValidationRule(strval.hasMaxLength(128));\n\n        validator.for<string>(\"description\")\n            .isOptional()\n            .ensureIsString()\n            .useValidationRule(strval.hasMaxLength(500));\n\n        validator.validate(model);\n\n        if (validator.hasErrors)\n            throw new ValidationException(validator.errors);\n    }\n}\n\n\ninterface Model\n{\n    id: string;\n    title: string;\n    description?: string;\n}"]}