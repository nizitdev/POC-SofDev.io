{"version":3,"file":"create-todo-controller.js","sourceRoot":"","sources":["create-todo-controller.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAAA,8CAAgE;AAChE,oCAAoC;AACpC,gDAA6C;AAC7C,0DAAiD;AAEjD,wDAA4D;AAC5D,gFAA4E;AAM5E,IAAa,oBAAoB,GAAjC,MAAa,oBAAqB,SAAQ,kBAAU;IAKhD,YAAmB,WAAwB;QAEvC,KAAK,EAAE,CAAC;QAER,mBAAK,CAAC,WAAW,EAAE,aAAa,CAAC,CAAC,cAAc,EAAE,CAAC,cAAc,EAAE,CAAC;QACpE,IAAI,CAAC,YAAY,GAAG,WAAW,CAAC;IACpC,CAAC;IAGY,OAAO,CAAC,KAAY;;YAE7B,mBAAK,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC,cAAc,EAAE,CAAC,cAAc,EAAE,CAAC;YAExD,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;YAE1B,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,EAAE,KAAK,CAAC,WAAW,CAAC,CAAC;YAC5E,OAAO;gBACH,EAAE,EAAE,IAAI,CAAC,EAAE;gBACX,KAAK,EAAE,IAAI,CAAC,KAAK;gBACjB,WAAW,EAAE,IAAI,CAAC,WAAW;gBAC7B,WAAW,EAAE,IAAI,CAAC,WAAW;aAChC,CAAC;QACN,CAAC;KAAA;IAGO,aAAa,CAAC,KAAY;QAE9B,IAAI,SAAS,GAAG,IAAI,sBAAS,EAAS,CAAC;QAEvC,SAAS,CAAC,GAAG,CAAS,OAAO,CAAC;aACzB,UAAU,EAAE;aACZ,cAAc,EAAE;aAChB,iBAAiB,CAAC,mBAAM,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC,CAAC;QAEjD,SAAS,CAAC,GAAG,CAAS,aAAa,CAAC;aAC/B,UAAU,EAAE;aACZ,cAAc,EAAE;aAChB,iBAAiB,CAAC,mBAAM,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC,CAAC;QAEjD,SAAS,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;QAE1B,IAAI,SAAS,CAAC,SAAS;YACnB,MAAM,IAAI,0CAAmB,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC;IACxD,CAAC;CACJ,CAAA;AAjDY,oBAAoB;IAHhC,aAAK,CAAC,MAAM,CAAC,OAAO,CAAC,UAAU,CAAC;IAChC,eAAO;IACP,eAAM,CAAC,aAAa,CAAC;;GACT,oBAAoB,CAiDhC;AAjDY,oDAAoB","sourcesContent":["import { Controller, command, route } from \"@nivinjoseph/n-web\";\r\nimport * as Routes from \"../routes\";\r\nimport { inject } from \"@nivinjoseph/n-ject\";\r\nimport { given } from \"@nivinjoseph/n-defensive\";\r\nimport { TodoFactory } from \"../../../domain/factories/todo-factory\";\r\nimport { Validator, strval } from \"@nivinjoseph/n-validate\";\r\nimport { ValidationException } from \"../../exceptions/validation-exception\";\r\n\r\n\r\n@route(Routes.command.createTodo)\r\n@command\r\n@inject(\"TodoFactory\") \r\nexport class CreateTodoController extends Controller\r\n{\r\n    private readonly _todoFactory: TodoFactory;\r\n\r\n\r\n    public constructor(todoFactory: TodoFactory)\r\n    {\r\n        super();\r\n        \r\n        given(todoFactory, \"todoFactory\").ensureHasValue().ensureIsObject();\r\n        this._todoFactory = todoFactory;\r\n    }\r\n    \r\n    \r\n    public async execute(model: Model): Promise<object>\r\n    {\r\n        given(model, \"model\").ensureHasValue().ensureIsObject();\r\n\r\n        this.validateModel(model);\r\n        \r\n        const todo = await this._todoFactory.create(model.title, model.description);\r\n        return {\r\n            id: todo.id,\r\n            title: todo.title,\r\n            description: todo.description,\r\n            isCompleted: todo.isCompleted\r\n        };\r\n    }\r\n    \r\n    \r\n    private validateModel(model: Model): void\r\n    {\r\n        let validator = new Validator<Model>();\r\n\r\n        validator.for<string>(\"title\")\r\n            .isRequired()\r\n            .ensureIsString()\r\n            .useValidationRule(strval.hasMaxLength(128));\r\n\r\n        validator.for<string>(\"description\")\r\n            .isOptional()\r\n            .ensureIsString()\r\n            .useValidationRule(strval.hasMaxLength(500));\r\n\r\n        validator.validate(model);\r\n\r\n        if (validator.hasErrors)\r\n            throw new ValidationException(validator.errors);\r\n    }\r\n}\r\n\r\n\r\ninterface Model\r\n{\r\n    title: string;\r\n    description?: string;\r\n}"]}