{"version":3,"file":"in-memory-todo-repository.js","sourceRoot":"","sources":["in-memory-todo-repository.ts"],"names":[],"mappings":";;;;;;;;;;;AACA,0DAAiD;AACjD,4DAAyD;AACzD,+FAAyF;AACzF,gDAA6C;AAK7C,IAAa,sBAAsB,GAAnC,MAAa,sBAAsB;IAM/B,YAAmB,aAA4B;QAE3C,mBAAK,CAAC,aAAa,EAAE,eAAe,CAAC,CAAC,cAAc,EAAE,CAAC,cAAc,EAAE,CAAC;QACxE,IAAI,CAAC,cAAc,GAAG,aAAa,CAAC;QAEpC,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC;IACrB,CAAC;IAGM,MAAM;QAET,MAAM,MAAM,GAAG,IAAI,KAAK,EAAQ,CAAC;QAEjC,KAAK,MAAM,GAAG,IAAI,IAAI,CAAC,MAAM,EAC7B;YACI,MAAM,CAAC,IAAI,CAAC,WAAI,CAAC,WAAW,CAAC,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;SAC7E;QAED,OAAO,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC;IACjE,CAAC;IAEM,GAAG,CAAC,EAAU;QAEjB,mBAAK,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC,cAAc,EAAE,CAAC,cAAc,EAAE,CAAC;QAElD,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC;YAChB,OAAO,OAAO,CAAC,MAAM,CAAC,IAAI,gDAAqB,CAAC,EAAE,CAAC,CAAC,CAAC;QAEzD,MAAM,MAAM,GAAG,WAAI,CAAC,WAAW,CAAC,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC;QAC3E,OAAO,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;IACnC,CAAC;IAEM,IAAI,CAAC,IAAU;QAElB,mBAAK,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC,cAAc,EAAE,CAAC,YAAY,CAAC,WAAI,CAAC,CAAC;QAExD,MAAM,IAAI,GAAQ,IAAI,CAAC,SAAS,EAAE,CAAC;QAEnC,MAAM,aAAa,GAAiB;YAChC,EAAE,EAAE,IAAI,CAAC,EAAE;YACX,OAAO,EAAE,IAAI,CAAC,cAAc;YAC5B,SAAS,EAAE,IAAI,CAAC,SAAS;YACzB,IAAI;YACJ,KAAK,EAAE,IAAI,CAAC,MAAM;SACrB,CAAC;QAEF,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,CAAC,CAAC;QAE3C,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,aAAa,CAAC;QAErC,OAAO,OAAO,CAAC,OAAO,EAAE,CAAC;IAC7B,CAAC;IAEO,MAAM,CAAC,EAAU;QAErB,mBAAK,CAAC,EAAE,EAAE,QAAQ,CAAC,CAAC,cAAc,EAAE,CAAC,cAAc,EAAE,CAAC;QAEtD,IAAI,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC;YACf,OAAO,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC;QAE3B,OAAO,OAAO,CAAC,OAAO,EAAE,CAAC;IAC7B,CAAC;CACJ,CAAA;AApEY,sBAAsB;IADlC,eAAM,CAAC,eAAe,CAAC;;GACX,sBAAsB,CAoElC;AApEY,wDAAsB","sourcesContent":["import { TodoRepository } from \"../../domain/repositories/todo-repository\";\nimport { given } from \"@nivinjoseph/n-defensive\";\nimport { Todo } from \"../../domain/aggregates/todo/todo\";\nimport { TodoNotFoundException } from \"../../domain/exceptions/todo-not-found-exception\";\nimport { inject } from \"@nivinjoseph/n-ject\";\nimport { DomainContext } from \"@nivinjoseph/n-domain\";\n\n\n@inject(\"DomainContext\")\nexport class InMemoryTodoRepository implements TodoRepository\n{\n    private readonly _domainContext: DomainContext;\n    private readonly _todos: { [index: string]: StorageModel };\n    \n    \n    public constructor(domainContext: DomainContext)\n    {\n        given(domainContext, \"domainContext\").ensureHasValue().ensureIsObject();\n        this._domainContext = domainContext;\n        \n        this._todos = {};\n    }\n    \n    \n    public getAll(): Promise<ReadonlyArray<Todo>>\n    {\n        const result = new Array<Todo>();\n\n        for (const key in this._todos)\n        {\n            result.push(Todo.deserialize(this._domainContext, this._todos[key].data));\n        }\n\n        return Promise.resolve(result.orderByDesc(t => t.updatedAt));\n    }\n    \n    public get(id: string): Promise<Todo>\n    {\n        given(id, \"id\").ensureHasValue().ensureIsString();\n        \n        if (!this._todos[id])\n            return Promise.reject(new TodoNotFoundException(id));\n        \n        const result = Todo.deserialize(this._domainContext, this._todos[id].data);\n        return Promise.resolve(result);\n    }\n    \n    public save(todo: Todo): Promise<void>\n    {\n        given(todo, \"todo\").ensureHasValue().ensureIsType(Todo);\n\n        const data: any = todo.serialize();\n\n        const storageEntity: StorageModel = {\n            id: todo.id,\n            version: todo.currentVersion,\n            updatedAt: todo.updatedAt,\n            data,\n            query: data.$state\n        };\n\n        console.log(JSON.stringify(storageEntity));\n        \n        this._todos[todo.id] = storageEntity;\n        \n        return Promise.resolve();\n    }\n    \n    public  delete(id: string): Promise<void>\n    {\n        given(id, \"string\").ensureHasValue().ensureIsString();\n\n        if (this._todos[id])\n            delete this._todos[id];\n        \n        return Promise.resolve();\n    }\n}\n\n\ninterface StorageModel\n{\n    id: string;\n    version: number;\n    updatedAt: number;\n    data: object;\n    query: object;\n}"]}